thread race and memory leak
